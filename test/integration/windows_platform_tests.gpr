-- ===========================================================================
-- windows_platform_tests.gpr - Standalone Windows Platform Test
-- ===========================================================================
-- Purpose:
--   Minimal standalone project for Windows CI testing.
--   Does NOT depend on tzif_config.gpr to avoid gnatcoll dependencies.
--   Only builds what's needed for Windows platform validation.
--
-- Tests:
--   - Windows Win32 GetDynamicTimeZoneInformation API
--   - CLDR Windows-to-IANA timezone mapping
-- ===========================================================================

with "functional.gpr";

project Windows_Platform_Tests is

   for Source_Dirs use
     (".",
      "../common",
      "../support",
      "../../src/domain",
      "../../src/domain/entity",
      "../../src/domain/error",
      "../../src/domain/service",
      "../../src/domain/types",
      "../../src/domain/value_object",
      "../../src/domain/parser",
      "../../src/infrastructure",
      "../../src/infrastructure/platform",
      "../../src/infrastructure/platform/windows",
      "../../src/infrastructure/paths",
      "../../src/infrastructure/ulid",
      "../../src/infrastructure/cache",
      "../../config/profiles/standard");

   --  Exclude POSIX platform and desktop IO (not available on Windows)
   for Excluded_Source_Files use
     ("tzif-infrastructure-platform-posix.ads",
      "tzif-infrastructure-platform-posix.adb",
      "tzif-infrastructure-io-desktop.ads",
      "tzif-infrastructure-io-desktop.adb",
      "tzif-infrastructure-io.ads",
      "tzif-infrastructure-tzif_parser.ads",
      "tzif-infrastructure-tzif_parser.adb",
      "tzif-infrastructure-query_timezone_info.ads",
      "tzif-infrastructure-query_timezone_info.adb",
      "tzif-infrastructure-cpu.ads",
      "tzif-infrastructure-cpu.adb",
      "tzif-domain-service-timezone_lookup.ads",
      "tzif-domain-service-timezone_lookup.adb",
      "tzif-domain-parser.ads",
      "tzif-domain-parser.adb",
      "tzif-domain-tzif_data.ads",
      "tzif-domain-tzif_data.adb");

   for Object_Dir use "../../obj/test/windows_platform";
   for Exec_Dir use "../bin";

   for Main use ("test_windows_platform.adb");

   package Compiler is
      for Default_Switches ("Ada") use
        ("-gnat2022",
         "-gnatwa",
         "-g",
         "-O0");
   end Compiler;

   package Binder is
      for Switches ("Ada") use ("-Es");  -- Symbolic traceback
   end Binder;

   package Builder is
      for Switches ("Ada") use ("-g");  -- Debug symbols
   end Builder;

end Windows_Platform_Tests;
